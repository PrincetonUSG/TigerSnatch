const toastAdded=$($.parseHTML('\n<div\n    id="toast-added"\n    class="toast align-items-center text-white bg-success border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Successfully subscribed!</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastRemoved=$($.parseHTML('\n<div\n    id="toast-removed"\n    class="toast align-items-center text-white bg-warning border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Successfully unsubscribed!</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastUserDoesNotExist=$($.parseHTML('\n<div\n    id="toast-user-does-not-exist"\n    class="toast align-items-center text-white bg-danger border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">That netID does not exist.</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastEmailsOn=$($.parseHTML('\n<div\n    id="toast-emails-on"\n    class="toast align-items-center text-white bg-success border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Email notifications turned on! Reloading in a few seconds...</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastEmailsOff=$($.parseHTML('\n<div\n    id="toast-emails-off"\n    class="toast align-items-center text-white bg-success border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Email notifications turned off! Reloading in a few seconds...</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastClearSuccess=$($.parseHTML('\n<div\n    id="toast-clear-success"\n    class="toast align-items-center text-white bg-success border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Cleared sucessfully!</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastClearFail=$($.parseHTML('\n<div\n    id="toast-clear-fail"\n    class="toast align-items-center text-white bg-danger border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Failed to clear. Check course/class ID or contact a TigerSnatch developer for assistance.</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastDisableEnableCourseSuccess=$($.parseHTML('\n<div\n    id="toast-disable-enable-course-success"\n    class="toast align-items-center text-white bg-success border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Successfully disabled/enabled course subscriptions!</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastDisableEnableCourseFail=$($.parseHTML('\n<div\n    id="toast-disable-enable-course-fail"\n    class="toast align-items-center text-white bg-danger border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Failed to disable/enable course subscriptions. Check course ID or contact a TigerSnatch developer for assistance.</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastFillSuccess=$($.parseHTML('\n<div\n    id="toast-clear-success"\n    class="toast align-items-center text-white bg-success border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Filled section sucessfully!</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastFillFail=$($.parseHTML('\n<div\n    id="toast-clear-fail"\n    class="toast align-items-center text-white bg-danger border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Failed to fill section. Check class ID or contact a TigerSnatch developer for assistance.</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastUpdateTerm=$($.parseHTML('\n<div\n    id="toast-update-term"\n    class="toast align-items-center text-white bg-success border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">TigerSnatch will update to the latest term and go offline for 2-3 minutes. Reloading in a few seconds...</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastBlacklistFail=$($.parseHTML('\n<div\n    id="toast-blacklist-fail"\n    class="toast align-items-center text-white bg-danger border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Failed to blacklist/unblacklist user.</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastBlacklistSuccess=$($.parseHTML('\n<div\n    id="toast-blacklist-success"\n    class="toast align-items-center text-white bg-success border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Successfully blocked/unblocked user! Reloading in a few seconds...</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastAddedSection=$($.parseHTML('\n<div\n    id="toast-updatesection"\n    class="toast align-items-center text-white bg-success border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Successfully saved your current section for this course!</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastAddedSectionFail=$($.parseHTML('\n<div\n    id="toast-updatesection-fail"\n    class="toast align-items-center text-white bg-danger border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Failed to save your current section for this course.</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastRemovedSection=$($.parseHTML('\n<div\n    id="toast-removedsection-success"\n    class="toast align-items-center text-white bg-warning border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Successfully removed your current section for this course!</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n')),
toastRemovedSectionFail=$($.parseHTML('\n<div\n    id="toast-removedsection-fail"\n    class="toast align-items-center text-white bg-danger border-0"\n    role="alert"\n    aria-live="assertive"\n    aria-atomic="true"\n    data-bs-delay="3000"\n>\n    <div class="d-flex">\n        <div class="toast-body">Failed to remove your current section for this course.</div>\n        <button\n            type="button"\n            class="btn-close btn-close-white me-2 m-auto"\n            data-bs-dismiss="toast"\n            aria-label="Close"\n        ></button>\n    </div>\n</div>\n'));
i=0;
let scrollBottom=function(a){$(a).animate({scrollTop:$(a)[0].scrollHeight-$(a)[0].clientHeight},500)},resetScroll=function(a){$(a).animate({scrollTop:0},500)},searchFormListener=function(){$("form#search-form").on("submit",function(a){a.preventDefault();$("#search-form-input").blur();$("#search-form-input").tooltip("hide")});$("form#search-form").on("input",function(a){a.preventDefault();query=encodeURIComponent($("#search-form-input").prop("value"));if(!(2>query.length))if(2==query.length)$.post("/searchresults_placeholder",function(b){$("div#search-results").html(b)});
else{$("#search-form-input").tooltip("hide");params=location.search;curr_path=location.pathname;if(""===params)curr_path=curr_path+"?query="+query;else for(curr_path+="?",params=params.replace("?",""),arr=params.split("&"),a=0;a<arr.length;a++)0<a&&(curr_path+="&"),curr_path=arr[a].startsWith("query")?curr_path+"query="+query:curr_path+arr[a];endpoint=""===query.trim()?"/searchresults":`/searchresults/${query}`;$.post(endpoint,function(b){$("div#search-results").html(b);window.history.pushState({restore:"search",
html:b},"restore search results",curr_path);searchResultListener();resetScroll("#search-results");dashboardSkip()})}})},searchResultListener=function(){$(".search-results-link").on("click",function(a){a.preventDefault();$("#main").css("pointer-events","none");$("#main").css("filter","blur(2px)");$("#loading-overlay").css("display","flex");$("a.selected-course").css("background-color","");$("a.selected-course").removeClass("selected-course border border-3 border-warning");closest_a=$(this).closest("a");
closest_a.css("background-color","#ffe58a");closest_a.addClass("selected-course border border-3 border-warning");course_link=closest_a.attr("href");courseid=closest_a.attr("data-courseid");scrollBottom("#main");$.post(`/courseinfo/${courseid}`,function(b){$("form#search-form").attr("action","/course");$("input#search-form-courseid").attr("value",courseid);$("#right-wrapper").html(b);$("#loading-overlay").css("display","none");$("#main").css("filter","");$("#main").css("pointer-events","");window.history.pushState({restore:"right",
html:b},"",course_link);switchListener();initTooltipsToasts();showAllListener();modalCancelListener();modalConfirmListener();searchSkip();updateCurrentSection();removeCurrentSection();findMatches()})})},dashboardCourseSelectListener=function(){$(".dashboard-course-link").on("click",function(a){$("#loading-overlay").css("display","flex");$("#main").css("pointer-events","none");$("#main").css("filter","blur(2px)")})},disableSwitchFunctions=function(){$(".waitlist-switch").attr("disabled",!0);$("#auto-resub-switch").attr("disabled",
!0);$("*").css("pointer-events","none");$("*").css("cursor","wait")},enableSwitchFunctions=function(){$(".waitlist-switch").attr("disabled",!1);$("#auto-resub-switch").attr("disabled",!1);$("*").css("pointer-events","");$("*").css("cursor","")},switchListener=function(){$("input.waitlist-switch").change(function(a){a.preventDefault();classid=a.target.getAttribute("data-classid");$("#confirm-remove-waitlist").attr("data-classid",classid);$("#close-waitlist-modal").attr("data-classid",classid);switchid=
`#switch-${classid}`;n_tigers=$(this).closest("td").next("td");$(switchid).attr("checked")||(disableSwitchFunctions(),$.post(`/add_to_waitlist/${classid}`,function(b){2!==b.isSuccess&&(0===b.isSuccess?($("#close-waitlist-modal").modal("show"),$(switchid).attr("checked",!1),$(switchid).prop("checked",!1),enableSwitchFunctions()):(n_tigers.html(Number(n_tigers.html())+1),$(switchid).attr("checked",!0),$(switchid).attr("data-bs-toggle","modal"),$(switchid).attr("data-bs-target","#confirm-remove-waitlist"),
enableSwitchFunctions(),$(".toast-container").prepend(toastAdded.clone().attr("id","toast-added-"+ ++i)),$("#toast-added-"+i).toast("show")))}))})},autoResubSwitchListener=function(){$("#auto-resub-switch").change(function(a){a.preventDefault();disableSwitchFunctions();const b=$("#auto-resub-switch").prop("checked");$.post(`/update_auto_resub/${b}`,function(c){c.isSuccess?b?alert("Notification settings successfully changed: You will keep receiving open-spot notifications for a section until you manually unsubscribe."):
alert("Notification settings successfully changed: You will be automatically unsubscribed from a section upon first notification."):$("#auto-resub-switch").prop("checked",!b);enableSwitchFunctions()})})},modalConfirmListener=function(){$("#waitlist-modal-confirm").on("click",function(a){a.preventDefault();classid=$("#confirm-remove-waitlist").attr("data-classid");switchid=`#switch-${classid}`;disableSwitchFunctions();n_tigers=$(switchid).closest("td").next("td");$.post(`/remove_from_waitlist/${classid}`,
function(b){b.isSuccess&&(n_tigers.html(Number(n_tigers.html())-1),$(`${switchid}.dashboard-switch`).closest("tr.dashboard-course-row").remove(),$(switchid).removeAttr("checked"),$(switchid).removeAttr("data-bs-toggle"),$(switchid).removeAttr("data-bs-target"),enableSwitchFunctions(),$(".toast-container").prepend(toastRemoved.clone().attr("id","toast-removed-"+ ++i)),$("#toast-removed-"+i).toast("show"))})})},modalCancelListener=function(){$("#waitlist-modal-cancel").on("click",function(a){a.preventDefault();
classid=$("#confirm-remove-waitlist").attr("data-classid");$(`#switch-${classid}`).prop("checked",!0)})},showAllListener=function(){$("#show-all-check").on("click",function(a){$(this).prop("checked")?($(".available-section-row").removeClass("d-none"),$("#no-full-message").addClass("d-none")):($(".available-section-row").addClass("d-none"),$("#no-full-message").removeClass("d-none"))})},pageBackListener=function(){$(window).on("popstate",function(){location.reload()})},dashboardSkip=function(){$("#dashboard-skip").on("click",
function(a){a.preventDefault();scrollBottom("#main")});-1!==window.location.href.indexOf("skip")&&$("#dashboard-skip").click()},searchSkip=function(){$("#search-skip").on("click",function(a){a.preventDefault();resetScroll("#main")})},initTooltipsToasts=function(){[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(a){return new bootstrap.Tooltip(a)});$("#status-indicator").on("click",function(a){a.preventDefault()});$("#dev-warning").on("click",function(a){a.preventDefault()})},
navbarAutoclose=function(){$(document).click(function(a){a=$(a.target);!$(".navbar-collapse").hasClass("show")||a.hasClass("navbar-toggler")||a.hasClass("nav-item")||a.hasClass("nav-button")||a.hasClass("nav-link")||$(".navbar-toggler").click()})},blacklistToastHelper=function(a){"success"===a?($(".toast-container").prepend(toastBlacklistSuccess.clone().attr("id","toast-blacklist-success-"+ ++i)),$("#toast-blacklist-success-"+i).toast("show"),$("*").css("pointer-events","none"),setTimeout(()=>location.reload(),
3100)):"fail"===a&&($(".toast-container").prepend(toastBlacklistFail.clone().attr("id","toast-blacklist-fail-"+ ++i)),$("#toast-blacklist-fail-"+i).toast("show"))},blacklistListener=function(){$("button.btn-blacklist").on("click",function(a){a.preventDefault();confirm("Are you sure you want to blacklist this user?")&&(disableAdminFunction(),netid=a.target.getAttribute("data-netid"),$.post(`/add_to_blacklist/${netid}`,function(b){b.isSuccess?blacklistToastHelper("success"):(enableAdminFunction(),blacklistToastHelper("fail"))}))})},
blacklistRemovalListener=function(){$("button.btn-blacklist-removal").on("click",function(a){a.preventDefault();confirm("Are you sure you want to unblacklist this user?")&&(disableAdminFunction(),netid=a.target.getAttribute("data-netid"),$.post(`/remove_from_blacklist/${netid}`,function(b){b.isSuccess?blacklistToastHelper("success"):(blacklistToastHelper("fail"),enableAdminFunction())}))})},getUserInfoListener=function(){$("button.btn-user-info").on("click",function(a){a.preventDefault();disableAdminFunction();
netid=a.target.getAttribute("data-netid");$.post(`/get_user_data/${netid}/${!1}`,function(b){if("missing"===b.data)$(".toast-container").prepend(toastUserDoesNotExist.clone().attr("id","toast-user-does-not-exist-"+ ++i)),$("#toast-user-does-not-exist-"+i).toast("show"),enableAdminFunction();else{b=b.data.split("{");$("#get-user-data-input").val("");dataHTML="";for(let c of b)dataHTML+=`<p class="my-1">&#8594; ${c}</p>`;$("#modal-body-user-data").html(dataHTML);$("#user-data-waitlist-modal").modal("show")}$("#staticBackdropLabelUserData").html(`Subscribed Sections for ${netid}`);
enableAdminFunction()})})},getUsageSummaryListener=function(){$("#usage-summary").on("click",function(a){a.preventDefault();disableAdminFunction();$.post("/get_usage_summary",function(b){if("error"===b.data)enableAdminFunction();else{b=b.data.split("{");dataHTML="";for(let c of b)dataHTML+=`<p class="my-1">&#8594; ${c}</p>`;$("#modal-body-usage-summary").html(dataHTML);$("#usage-summary-modal").modal("show")}enableAdminFunction()})})},getAllSubscriptionsListener=function(){$("#all-subscriptions").on("click",
function(a){a.preventDefault();disableAdminFunction();$.post("/get_all_subscriptions",function(b){if("error"===b.data)enableAdminFunction();else{b=b.data.split("{");dataHTML="";for(let c of b)dataHTML+=`<p class="my-1">&#8594; ${c}</p>`;$("#modal-body-all-subscriptions").html(dataHTML);$("#all-subscriptions-modal").modal("show")}enableAdminFunction()})})},enableAdminFunction=function(){$(".btn-blacklist").attr("disabled",!1);$(".btn-blacklist-removal").attr("disabled",!1);$(".btn-user-info").attr("disabled",
!1);$("#notifs-sheet-link").attr("disabled",!1);$("#usage-summary").attr("disabled",!1);$("#all-subscriptions").attr("disabled",!1);$("#clear-all").attr("disabled",!1);$("#clear-all-trades").attr("disabled",!1);$("#clear-all-logs").attr("disabled",!1);$("#update-term").attr("disabled",!1);$("#toggle-emails").attr("disabled",!1);$("#disable-course-input").attr("disabled",!1);$("#disable-course-submit").attr("disabled",!1);$("#enable-course-input").attr("disabled",!1);$("#enable-course-submit").attr("disabled",
!1);$("#classid-clear-input").attr("disabled",!1);$("#classid-clear-submit").attr("disabled",!1);$("#courseid-clear-input").attr("disabled",!1);$("#courseid-clear-submit").attr("disabled",!1);$("#get-user-data-input").attr("disabled",!1);$("#get-user-data-submit").attr("disabled",!1);$("#fill-section-input").attr("disabled",!1);$("#get-user-trade-data-input").attr("disabled",!1);$("#get-user-trade-data-submit").attr("disabled",!1);$("#fill-section-submit").attr("disabled",!1)},disableAdminFunction=
function(){$(".btn-blacklist").attr("disabled",!0);$(".btn-blacklist-removal").attr("disabled",!0);$(".btn-user-info").attr("disabled",!0);$("#notifs-sheet-link").attr("disabled",!0);$("#usage-summary").attr("disabled",!0);$("#all-subscriptions").attr("disabled",!0);$("#clear-all").attr("disabled",!0);$("#clear-all-trades").attr("disabled",!0);$("#clear-all-logs").attr("disabled",!0);$("#update-term").attr("disabled",!0);$("#toggle-emails").attr("disabled",!0);$("#disable-course-input").attr("disabled",
!0);$("#disable-course-submit").attr("disabled",!0);$("#enable-course-input").attr("disabled",!0);$("#enable-course-submit").attr("disabled",!0);$("#classid-clear-input").attr("disabled",!0);$("#classid-clear-submit").attr("disabled",!0);$("#courseid-clear-input").attr("disabled",!0);$("#courseid-clear-submit").attr("disabled",!0);$("#get-user-data-input").attr("disabled",!0);$("#get-user-data-submit").attr("disabled",!0);$("#fill-section-input").attr("disabled",!0);$("#get-user-trade-data-input").attr("disabled",
!0);$("#get-user-trade-data-submit").attr("disabled",!0);$("#fill-section-submit").attr("disabled",!0)},toggleEmailNotificationsListener=function(){$("#notifs-sheet-link").on("click",function(a){a.preventDefault();window.open("https://docs.google.com/spreadsheets/d/1iSWihUcWa0yX8MsS_FKC-DuGH75AukdiuAigbSkPm8k/edit#gid=550138744","_blank")})},initToggleEmailNotificationsButton=function(){$.post("/get_notifications_status",function(a){a.isOn?$("#toggle-emails").html("Turn Off"):$("#toggle-emails").html("Turn On");
enableAdminFunction()})},clearWaitlistsToastHelper=function(a){a.isSuccess?($(".toast-container").prepend(toastClearSuccess.clone().attr("id","toast-clear-success-"+ ++i)),$("#toast-clear-success-"+i).toast("show")):($(".toast-container").prepend(toastClearFail.clone().attr("id","toast-clear-fail-"+ ++i)),$("#toast-clear-fail-"+i).toast("show"))},disableEnableCourseToastHelper=function(a){a.isSuccess?($(".toast-container").prepend(toastDisableEnableCourseSuccess.clone().attr("id","toast-disable-enable-course-success-"+
++i)),$("#toast-disable-enable-course-success-"+i).toast("show")):($(".toast-container").prepend(toastDisableEnableCourseFail.clone().attr("id","toast-disable-enable-course-fail-"+ ++i)),$("#toast-disable-enable-course-fail-"+i).toast("show"))},fillSectionToastHelper=function(a){a.isSuccess?($(".toast-container").prepend(toastFillSuccess.clone().attr("id","toast-clear-success-"+ ++i)),$("#toast-clear-success-"+i).toast("show")):($(".toast-container").prepend(toastFillFail.clone().attr("id","toast-clear-fail-"+
++i)),$("#toast-clear-fail-"+i).toast("show"))},clearAllWaitlistsListener=function(){$("#clear-all").on("click",function(a){a.preventDefault();disableAdminFunction();confirm("Are you sure you want to clear all subscriptions? This action is irreversible.")?$.post("/clear_all_waitlists",function(b){clearWaitlistsToastHelper(b);enableAdminFunction()}):enableAdminFunction()})},updateTermListener=function(){$("#update-term").on("click",function(a){a.preventDefault();disableAdminFunction();confirm("Are you sure you want to update TigerSnatch to the latest term? This action will clear ALL term-specific data (including user logs, Trades, subscriptions, and curent sections) and is irreversible. TigerSnatch will go into maintenance mode for 2-3 minutes while updating.")?
confirm("Are you ABSOLUTELY sure you want to update TigerSnatch to the latest term?")?($("*").css("pointer-events","none"),setTimeout(()=>location.reload(),3100),$(".toast-container").prepend(toastUpdateTerm.clone().attr("id","toast-update-term-"+ ++i)),$("#toast-update-term-"+i).toast("show"),$.post("/update_all_courses",function(b){})):enableAdminFunction():enableAdminFunction()})},clearAllTradesListener=function(){$("#clear-all-trades").on("click",function(a){a.preventDefault();disableAdminFunction();
confirm("Are you sure you want to clear all Trades? This action is irreversible.")?$.post("/clear_all_trades",function(b){clearWaitlistsToastHelper(b);enableAdminFunction()}):enableAdminFunction()})},clearAllLogsListener=function(){$("#clear-all-logs").on("click",function(a){a.preventDefault();disableAdminFunction();confirm("Are you sure you want to clear all user logs? This action is irreversible.")?$.post("/clear_all_user_logs",function(b){clearWaitlistsToastHelper(b);enableAdminFunction()}):enableAdminFunction()})},
clearClassWaitlistListener=function(){$("#classid-clear").on("submit",function(a){a.preventDefault();classid=$("#classid-clear-input").val();disableAdminFunction();confirm(`Are you sure you want to clear subscriptions for class ${classid}? This action is irreversible.`)?$.post(`/clear_by_class/${classid}`,function(b){clearWaitlistsToastHelper(b);$("#classid-clear-input").val("");enableAdminFunction()}):enableAdminFunction()})},fillSectionListener=function(){$("#fill-section").on("submit",function(a){a.preventDefault();
classid=$("#fill-section-input").val();disableAdminFunction();$.post(`/fill_section/${classid}`,function(b){fillSectionToastHelper(b);$("#fill-section-input").val("");enableAdminFunction()})})},clearCourseWaitlistListener=function(){$("#courseid-clear").on("submit",function(a){a.preventDefault();courseid=$("#courseid-clear-input").val();disableAdminFunction();confirm(`Are you sure you want to clear subscriptions for course ${courseid}? This action is irreversible.`)?$.post(`/clear_by_course/${courseid}`,
function(b){clearWaitlistsToastHelper(b);$("#courseid-clear-input").val("");enableAdminFunction()}):enableAdminFunction()})},disableCourseListener=function(){$("#disable-course").on("submit",function(a){a.preventDefault();courseid=$("#disable-course-input").val();disableAdminFunction();confirm(`Are you sure you want to disable course ${courseid}? This action will unsubscribe all users from the course's sections and is irreversible.`)?$.post(`/disable_course/${courseid}`,function(b){disableEnableCourseToastHelper(b);
$("#disable-course-input").val("");enableAdminFunction()}):enableAdminFunction()})},enableCourseListener=function(){$("#enable-course").on("submit",function(a){a.preventDefault();courseid=$("#enable-course-input").val();disableAdminFunction();$.post(`/enable_course/${courseid}`,function(b){disableEnableCourseToastHelper(b);$("#enable-course-input").val("");enableAdminFunction()})})},getUserDataListener=function(){let a=function(b,c){if("missing"===b.data)$(".toast-container").prepend(toastUserDoesNotExist.clone().attr("id",
"toast-user-does-not-exist-"+ ++i)),$("#toast-user-does-not-exist-"+i).toast("show"),enableAdminFunction();else{b=b.data.split("{");$(`#get-${c}-input`).val("");dataHTML="";for(let d of b)dataHTML+=`<p class="my-1">&#8594; ${d}</p>`;$("#modal-body-user-data").html(dataHTML);$("#user-data-waitlist-modal").modal("show")}};$("#get-user-data").on("submit",function(b){b.preventDefault();netid=$("#get-user-data-input").val();disableAdminFunction();$.post(`/get_user_data/${netid}/${!1}`,function(c){a(c,
"user-data");$("#staticBackdropLabelUserData").html(`Subscribed Sections for ${netid}`);enableAdminFunction()})});$("#get-user-trade-data").on("submit",function(b){b.preventDefault();netid=$("#get-user-trade-data-input").val();disableAdminFunction();$.post(`/get_user_data/${netid}/${!0}`,function(c){a(c,"user-trade-data");$("#staticBackdropLabelUserData").html(`Trade Sections for ${netid}`);enableAdminFunction()})})},disableTradeFunction=function(){$(".submit-trade").attr("disabled",!0);$(".save-trade").attr("disabled",
!0);$(".remove-trade").attr("disabled",!0);$("*").css("pointer-events","none");$("*").css("cursor","wait")},enableTradeFunction=function(){$(".submit-trade").attr("disabled",!1);$(".remove-trade").attr("disabled",!1);$(".save-trade").attr("disabled",!1);$("*").css("pointer-events","");$("*").css("cursor","")},updateSectionToastHelper=function(a){a.isSuccess?($(".toast-container").prepend(toastAddedSection.clone().attr("id","toast-updatesection-success-"+ ++i)),$("#toast-updatesection-success-"+i).toast("show")):
($(".toast-container").prepend(toastAddedSectionFail.clone().attr("id","toast-updatesection-fail-"+ ++i)),$("#toast-updatesection-fail-"+i).toast("show"))},removeSectionToastHelper=function(a){a.isSuccess?($(".toast-container").prepend(toastRemovedSection.clone().attr("id","toast-removedsection-success-"+ ++i)),$("#toast-removedsection-success-"+i).toast("show")):($(".toast-container").prepend(toastRemovedSectionFail.clone().attr("id","toast-removedsection-fail-"+ ++i)),$("#toast-removedsection-fail-"+
i).toast("show"))},updateCurrentSection=function(){$(".trade-form").on("submit",function(a){a.preventDefault();courseid=a.target.getAttribute("courseid");classid=$(`#sections-${courseid}`).val();disableTradeFunction();$.post(`/update_user_section/${courseid}/${classid}`,function(b){updateSectionToastHelper(b);curr_section=$(`#sections-${courseid} option:selected`).text();$(".submit-trade").attr("curr-section",curr_section);enableTradeFunction()})})},removeCurrentSection=function(){$(".remove-trade").on("click",
function(a){a.preventDefault();courseid=a.target.getAttribute("courseid");disableTradeFunction();$.post(`/remove_user_section/${courseid}`,function(b){removeSectionToastHelper(b);$(".save-trade").attr("disabled",!1);$("*").css("pointer-events","");$("*").css("cursor","");$(`#sections-${courseid}`).val("")})})},createEmail=function(a,b,c,d,e,f){return encodeURI(`//mail.google.com/mail/?view=cm&fs=1&to=${f}&su=${`TigerSnatch: Trade Sections for ${c} in ${e}?`}&body=${`Hi ${a},\n\nFrom TigerSnatch, I saw that you're enrolled in ${e} ${c}. I'm currently in ${d}.\nWould you like to set up a time to trade sections with me? We should plan on swapping our sections simultaneously to prevent other TigerSnatch users from taking our spots.\n\nThank you,\n${b}`}`)},
findMatches=function(){$(".submit-trade").on("click",function(a){a.preventDefault();courseid=a.target.getAttribute("courseid");netid=a.target.getAttribute("netid");coursename=a.target.getAttribute("coursename");disableTradeFunction();$.post(`/find_matches/${courseid}`,function(b){if(0!==b.data.length){s='<div>\n                        <svg\n                            id="dev-warning"\n                            xmlns="http://www.w3.org/2000/svg"\n                            width="16"\n                            height="16"\n                            fill="currentColor"\n                            class="bi bi-exclamation-triangle-fill text-primary"\n                            viewBox="0 0 16 18"\n                            >  \n                            <path\n                                d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"\n                            />\n                        </svg> Clicking \'Email\' will add an entry for you and your match in Activity. Exchanging seats is your and your match\'s responsibilities. Instructors are not responsible if your seats are taken by other students during the exchange.\n                    </div>\n                    <div class="table-responsive">\n                        <table class="table table-hover mt-2">\n                        <thead class="table-white">\n                            <tr>\n                                <th scope="col">NetID</th>\n                                <th scope="col">Current Section</th>\n                                <th scopt="col">Contact</th>\n                            </tr>\n                        </thead>\n                            <tbody>';
for(var c=0;c<b.data.length;c++)match_netid=b.data[c][0],match_section=b.data[c][1],my_section=$(".submit-trade").attr("curr-section"),coursename=$(".submit-trade").attr("coursename"),match_email=b.data[c][2],emailLink=createEmail(match_netid,netid,match_section,my_section,coursename,match_email),s+=`<tr>
                        <td>${b.data[c][0]}</td>
                        <td>${b.data[c][1]}</td>
                        <td><a href=${emailLink} target='_blank' class='btn btn-outline-primary contact-button' match-netid=${b.data[c][0]} match-section=${b.data[c][1]}>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-envelope me-1" viewBox="0 0 18 18">
                                <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2zm13 2.383-4.758 2.855L15 11.114v-5.73zm-.034 6.878L9.271 8.82 8 9.583 6.728 8.82l-5.694 3.44A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.739zM1 11.114l4.758-2.876L1 5.383v5.73z"/>
                            </svg>Email
                        </a>
                    </td>
                        </tr>`;s+="</tbody></table></div>";$(`#match-${courseid}`).html(s);$(".contact-button").on("click",function(d){d.preventDefault();$(".contact-button").attr("disabled",!0);matchNetid=d.target.getAttribute("match-netid");matchSection=d.target.getAttribute("match-section");matchNetid&&matchSection&&confirm("Are you sure you want to email this user? They will be notified on their Activity page if you confirm!")&&(window.open($(this).prop("href"),"_blank"),$.post(`/contact_trade/${coursename.split("/")[0]}/${matchNetid}/${matchSection}`,
function(e){$(".contact-button").attr("disabled",!1)}))});initTooltipsToasts()}else $(`#match-${courseid}`).html("We're unable to find you a Trade! If you haven't already, make sure to Subscribe to one or more sections for this course. Your Subscribed sections are the ones you'd like to trade into!");$("#matches-modal").modal("show");enableTradeFunction()})})};var doneKeyTutorial="completed2",doneKeyBanner="completed4";
let initTutorial=function(){var a=introJs();window.addEventListener("load",function(){"/dashboard"!==window.location.pathname||992>window.innerWidth||localStorage.getItem("EventTour")===doneKeyTutorial||(a.setOptions({showBullets:!1,showProgress:!0,tooltipClass:"tutorial-style"}).start(),a.oncomplete(function(){localStorage.setItem("EventTour",doneKeyTutorial)}),a.onexit(function(){localStorage.setItem("EventTour",doneKeyTutorial)}))})},initContactInfoChangeAlerts=function(){$("#new-email").submit(function(a){alert(`Email address successfully changed to ${$("#new-email-input").val()}!`)});
$("#new-phone").submit(function(a){$("#new-phone-input").val()?alert(`Phone number successfully changed to ${$("#new-phone-input").val()}!`):alert("Phone number successfully removed!")})},accountSettings=function(){$("#account-settings").submit(function(a){a.preventDefault();$("#account-settings-modal").modal("show")});localStorage.getItem("NewFeaturesAlert")!==doneKeyBanner&&$("#new-features-alert").removeClass("d-none");$("#new-features-alert-close").click(function(a){localStorage.setItem("NewFeaturesAlert",
doneKeyBanner)})},tradeFunctions=function(){updateCurrentSection();removeCurrentSection();findMatches()},mobileViewFunctions=function(){dashboardSkip();searchSkip();navbarAutoclose()},adminFunctions=function(){blacklistListener();blacklistRemovalListener();updateTermListener();clearAllWaitlistsListener();clearAllTradesListener();clearAllLogsListener();clearClassWaitlistListener();clearCourseWaitlistListener();disableCourseListener();enableCourseListener();getUsageSummaryListener();getAllSubscriptionsListener();
getUserDataListener();getUserInfoListener();initToggleEmailNotificationsButton();toggleEmailNotificationsListener();fillSectionListener()},searchFunctions=function(){searchFormListener();searchResultListener()},subscriptionFunctions=function(){switchListener();modalConfirmListener();modalCancelListener()},accountSettingsFunctions=function(){autoResubSwitchListener();initContactInfoChangeAlerts();accountSettings()};
$(document).ready(function(){tradeFunctions();mobileViewFunctions();adminFunctions();searchFunctions();subscriptionFunctions();showAllListener();pageBackListener();initTooltipsToasts();dashboardCourseSelectListener();initTutorial();accountSettingsFunctions()});
