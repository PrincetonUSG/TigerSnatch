{% extends 'base.html' %} 
{% block title %}
<title>TigerSnatch | Dashboard</title>
{% endblock %}

{% block content %}
<div id="search-wrapper" class="col-sm-4">
    <div>Search for a course</div>
    <form id="search-form" class="form-inline" action="/dashboard" method="get">
        {% include 'search_form.html' %}
    </form>
    {% include 'search_results.html' %}
</div>
<div id="dashboard-wrapper" class="col-sm-8">
    <p>Welcome {{ username }}!</p>
    <table class="table table-hover">
        <thead>
          <tr>
            <th scope="col">Course</th>
            <th scope="col">Section</th>
            <th scope="col">Time</th>
            <th scope="col">Days</th>
            <th scope="col">Enrollment</th>
            <th scope="col">Waitist Position</th>
            <th scope="col">Notify Me</th>
          </tr>
        </thead>
        <tbody>
            {% for classid in data.keys() %}
                <tr data-courseid="{{data[classid].courseid}}">
                    <td><a href="/course?query={{last_query}}&courseid={{data[classid].courseid}}">{{data[classid].displayname}}</a></td>
                    <td> {{data[classid].section}}</td>
                    {% if data[classid].end_time == "" %}
                        <td>{{data[classid].start_time}}</td>
                    {% else %}
                        <td>{{data[classid].start_time}} - {{data[classid].end_time}}</td>
                    {% endif %}
                    <td>{{data[classid].days}}</td>
                    <td>{{data[classid].enrollment}} / {{data[classid].capacity}}</td>
                    <td>{{data[classid].position}}</td>
                    <td>
                        <div class="form-check form-switch">
                            <input 
                                class="form-check-input waitlist-switch" 
                                type="checkbox"
                                id="switch-{{classid}}"
                                data-classid="{{classid}}"
                                data-bs-toggle="modal"
                                data-bs-target="#confirm-remove-waitlist"
                                checked
                            >
                        </div>
                    </td>
                    </tr>
            {%endfor%} 
        </tbody>
    </table>
      
    <!-- Modal -->
    <div class="modal fade" id="confirm-remove-waitlist" data-classid="" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="staticBackdropLabel">Confirm Removal from Waitlist</h5>
            </div>
            <div class="modal-body">
                Are you sure you want to remove yourself from this waitlist?
            </div>
            <div class="modal-footer">
                <button type="button" id="waitlist-modal-cancel" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" id="waitlist-modal-confirm" class="btn btn-primary" data-bs-dismiss="modal">Confirm</button>
            </div>
            </div>
        </div>
    </div>

    <form id='new_email' action="/dashboard" method="post">
        <div class="input-group">
            <label for="new_email" class="col-sm-2 col-form-label">Email</label>
            <input class="form-control" id='new_email' name="new_email" placeholder="{{ username + '@princeton.edu' }}" pattern="^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$" title="Invalid Email"/>
            <button class="btn btn-primary" type="submit">Change</button>
        </div>
    </form>
</div>
{% endblock %}
